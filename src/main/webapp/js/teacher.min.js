var CLIENT_ID="453755821502-1k95kijujmdh4g16opd1qpaqn6miboro.apps.googleusercontent.com";var SCOPES=["https://www.googleapis.com/auth/classroom.courses.readonly","profile","https://www.googleapis.com/auth/classroom.courses.readonly","https://www.googleapis.com/auth/classroom.rosters.readonly","https://www.googleapis.com/auth/classroom.profile.emails"];var currentStudents=[];var inClass=[];var currentCourse={id:"",name:""};var teacher=" ";function checkAuth(){gapi.auth.authorize({client_id:CLIENT_ID,scope:SCOPES.join(" "),immediate:true},handleAuthResult)}function handleAuthResult(a){var b=document.getElementById("sign-in");console.log(a);if(a&&!a.error){b.style.display="none";loadClassroomApi()}else{b.style.display="inline"}}function handleAuthClick(){gapi.auth.authorize({client_id:CLIENT_ID,scope:SCOPES.join(" "),immediate:false},handleAuthResult);return false}function loadClassroomApi(){gapi.client.load("classroom","v1",listCourses)}function listCourses(b){var a=gapi.client.classroom.courses.list({});a.execute(function(e){var d=e.courses;if(d.length>0){for(i=0;i<d.length;i++){var c=d[i];if(i==0){getTeacher(c.id)}appendDropdown(c.name,c.id)}}})}function getTeacher(b){var a=gapi.client.request({path:"https://classroom.googleapis.com/v1/courses/"+b+"/teachers",params:{}});a.execute(function(d){var c=d.teachers;teacher=c[0]})}function appendDropdown(a,b){$("#dropdown").append('<li><a href="javascript:selectCourse('+b+", '"+a+"')\">"+a+"</a></li>")}function appendStudent(c,d,a,b){console.log("name: "+c+" id: "+d+" status: "+a);$("#students").find("tbody").append($("<tr>").append($("<td>").text(c)).append($("<td>").text(d==""?"Could not find in .MER file":a).attr("id",d==""?b:d).attr("class",d==""?"no":"id")))}function signOut(){var a=gapi.auth.getAuthInstance();a.signOut().then(function(){console.log("User signed out.")})}function listStudents(b){var a=gapi.client.classroom.courses.students.list({courseId:b});a.execute(function(d){var e=d.students;inClass=e;for(i=0;i<e.length;i++){var c=e[i];console.log(c);appendStudent(c.profile.name.fullName,getIdFromName(c.profile.emailAddress),"Loading...",c.profile.emailAddress)}refreshInfoFromServer()})}function selectCourse(b,a){currentCourse.id=b;currentCourse.name=a;listStudents(b);$("#deadline-span").show();$("#requirements-span").show();$("#class-name").text(a);$("#button-bar").show()}function handleFileSelect(b){var c=b.target.files;if(typeof c!=="undefined"&&c[0].name.split(".")[c[0].name.split(".").length-1].toLowerCase()=="mer"){var a=new FileReader();a.onload=function(){readCSV(this.result)};a.readAsText(c[0])}else{alert("Please select a .MER file.")}}function readCSV(a){console.log(a);$.csv.toObjects(a,{separator:",",delimiter:'"'},function(d,e){if(typeof(Storage)!=="undefined"){for(var c=0;c<e.length;c++){localStorage.setItem((e[c]["LAST"].slice(0,3)+e[c]["FIRST"].slice(0,1)+e[c]["ID"].slice(3,6)+"0").toLowerCase(),e[c]["ID"])}localStorage.setItem("time",new Date().getTime())}else{for(var c=0;c<e.length;c++){var f={};var b=(e[c]["LAST"].slice(0,3)+e[c]["FIRST"].slice(0,1)+e[c]["ID"].slice(3,6)+"0").toLowerCase();f[b]=e[c]["ID"];currentStudents.push(f)}}$("#mer-file-label").text(".MER file selected just now");updateIds()})}function fileRead(){if(typeof(Storage)!=="undefined"){if(localStorage.getItem("time")!=null&&localStorage.getItem("time")!=""){return true}else{return false}}else{if(currentStudents.length>0){return true}else{return false}}}function getIdFromName(a){a=a.split("@")[0].toLowerCase();if(fileRead()){if(typeof(Storage)!=="undefined"){if(localStorage.getItem(a)!=null){return localStorage.getItem(a)}else{return""}}else{for(var b=0;b<currentStudents.length;b++){if(currentStudents[b].name==a){return currentStudents[b].id}}return""}}else{return""}}function updateIds(){var b=document.getElementsByClassName("no");for(var a=0;a<b.length;a++){b[a].id=getIdFromName(b[a].id);b[a].setAttribute("class","id")}refreshInfoFromServer()}function refreshInfoFromServer(){var d=document.getElementsByClassName("id");var c=[];for(var b=0;b<d.length;b++){c.push(d[b].id)}var a={teacher:teacher.profile.name.fullName,id:c};if(!location.origin){location.origin=location.protocol+"//"+location.host}console.log($.toJSON(a));$.ajax({type:"POST",url:location.origin+"/teacher/getInfo",data:$.toJSON(a),success:function(f){console.log(f);$("#deadline").datepicker("update",new Date(Number(f.deadline)));$("#total").val(Number(f.total));$("#blank").val(Number(f.blank));$("#scoredOver").val(Number(f.scoredOver));d=document.getElementsByClassName("id");for(var e=0;e<d.length;e++){d[e].innerHTML=f.results[d[e].id]}},error:function(f,e){console.log(f);console.log(e);alert("There was an error: "+e)}})}function updateRequirements(){var d=document.getElementsByClassName("id");var c=[];for(var b=0;b<d.length;b++){c.push(d[b].id)}var a={teacher:teacher.profile.name.fullName,id:c,total:$("#total").val(),blank:$("#blank").val(),scoredOver:$("#scoredOver").val(),deadline:$("#deadline").datepicker("getDate").getTime()};if(!location.origin){location.origin=location.protocol+"//"+location.host}console.log($.toJSON(a));$.ajax({type:"POST",url:location.origin+"/teacher/setInfo",data:$.toJSON(a),success:function(e){$("#deadline").datepicker("update",new Date(Number(e.deadline)));$("#total").val(Number(e.total));$("#blank").val(Number(e.blank));$("#scoredOver").val(Number(e.scoredOver));refreshInfoFromServer()},error:function(f,e){console.log(f);console.log(e);alert("There was an error: "+e)}})}function resetUsers(){var d=document.getElementsByClassName("id");var c=[];for(var b=0;b<d.length;b++){c.push(d[b].id)}var a={teacher:teacher.profile.name.fullName,id:c,total:$("#total").val(),blank:$("#blank").val(),scoredOver:$("#scoredOver").val(),deadline:$("#deadline").datepicker("getDate").getTime()};if(!location.origin){location.origin=location.protocol+"//"+location.host}console.log($.toJSON(a));$.ajax({type:"POST",url:location.origin+"/teacher/resetUsers",data:$.toJSON(a),success:function(e){$("#deadline").datepicker("update",new Date(Number(e.deadline)));$("#total").val(Number(e.total));$("#blank").val(Number(e.blank));$("#scoredOver").val(Number(e.scoredOver));refreshInfoFromServer()},error:function(f,e){console.log(f);console.log(e);alert("There was an error: "+e)}})}$(function(){if(window.File&&window.FileReader&&window.FileList){}else{alert("Please use Google Chrome or update your browser, as this site requires newer features not available in this version of your browser.")}document.getElementById("file-picker").addEventListener("change",handleFileSelect,false);if(typeof(Storage)!=="undefined"){if(localStorage.getItem("time")!==null&&localStorage.getItem("time")!=""){$("#mer-file-label").text(".MER file loaded from "+moment(Number(localStorage.getItem("time"))).fromNow())}}});